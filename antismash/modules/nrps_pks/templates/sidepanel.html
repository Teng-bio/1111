<div class="structure">
  {% if region.has_any_polymer() %}
    <h3>Predicted core structure(s)</h3>
    {% for supercluster in region.superclusters %}
      {% if supercluster.smiles or supercluster.polymer %}
        <div>
          <div class="prediction-text">
            For supercluster {{supercluster.number}}, location {{supercluster.location.start}} - {{supercluster.location.end}}:
          {{collapser_start("SC%s" % supercluster.number, level="supercluster")}}
          {% if supercluster.smiles %}
            <canvas id="smiles-canvas-{{supercluster.number}}" class="smiles-canvas" data-smiles="{{supercluster.smiles}}" width="250" height="250"></canvas>
            <div class="as-structure-warning">
              {{supercluster.get_warning()}}
            </div>
          {% endif %}
          {% if supercluster.polymer %}
            <div class="prediction-text">
              <dl>
                <dt><b>Polymer prediction:</b></dt><dd>{{supercluster.polymer}}</dd>
              </dl>
              <br>Direct lookup in NORINE database:
              <a href="{{supercluster.get_norine_url()}}" target="_new">strict</a>
                or
              <a href="{{supercluster.get_norine_url(be_strict = False)}}" target="_new">relaxed</a><br>
            </div>
            {% endif %}
            {{collapser_end()}}
            </div>
        </div>
      {% if loop.index < region.superclusters | length %}
        <hr>
      {% endif %}
      {% endif %}
    {% endfor %}
    <div class="prediction-text">
      <br>
      <a href="http://bioinfo.lifl.fr/norine/form2.jsp" target="_new">Link to NORINE database query form</a>
    </div>
  {% endif %}
</div>
<div class="more-details">
  <h3>NRPS/PKS domain predictions</h3>
  <dl class="prediction-text">
    {% for gene_id in region.sidepanel_features if gene_id in relevant_features %}
      <dt><strong>{{gene_id}}</strong></dt>
      {% if gene_id in region.url_strict %}
        <dd> Search NORINE for peptide:
          <a href="{{region.url_strict[gene_id]}}" target="_new">strict</a>
            or
          <a href="{{region.url_relaxed[gene_id]}}" target="_new">relaxed</a>
        </dd>
        <br>
      {% endif %}
      {% for domain in record.get_cds_by_name(gene_id).nrps_pks.domains %}
        {% if domain.feature_name in results.consensus %}
          <dd><strong>{{domain.name}} ({{domain.start}}..{{domain.end}})</strong>: {{results.consensus[domain.feature_name]}}
          {{collapser_start(gene_id, level="supercluster")}}
          {% for prediction in results.domain_predictions.get(domain.feature_name, {}).values() %}
              {{prediction.method}}:  {{prediction.get_classification() | join(", ") or "(unknown)"}}
              {{collapser_start(gene_id + "-" + prediction.method, level="none")}}
                {{prediction.as_html()}}
              {{collapser_end()}}<br>
          {% endfor %}
          {{collapser_end()}}
          </dd>
        {% endif %}
      {% endfor %}
      <br>
    {% endfor %}
  </dl>
</div>
